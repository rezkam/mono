openapi: 3.0.3
info:
  title: Mono Todo API
  description: A todo list and task management API with recurring task support
  version: 1.0.0
  contact:
    name: API Support

servers:
  - url: http://localhost:8081
    description: Development server

security:
  - BearerAuth: []

tags:
  - name: Lists
    description: Todo list management
  - name: Items
    description: Todo item management
  - name: Tasks
    description: Cross-list task search
  - name: Recurring
    description: Recurring task template management

paths:
  /v1/lists:
    post:
      operationId: createList
      summary: Create a new todo list
      tags: [Lists]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateListRequest'
      responses:
        '201':
          description: List created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoList'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

    get:
      operationId: listLists
      summary: List all todo lists with statistics
      description: Returns all lists with item counts (items array is empty)
      tags: [Lists]
      responses:
        '200':
          description: Lists retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListListsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /v1/lists/{listId}:
    get:
      operationId: getList
      summary: Get a single list with all items
      tags: [Lists]
      parameters:
        - $ref: '#/components/parameters/ListId'
      responses:
        '200':
          description: List retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /v1/lists/{listId}/items:
    post:
      operationId: createItem
      summary: Create a new todo item in a list
      tags: [Items]
      parameters:
        - $ref: '#/components/parameters/ListId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateItemRequest'
      responses:
        '201':
          description: Item created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoItem'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /v1/lists/{listId}/items/{itemId}:
    patch:
      operationId: updateItem
      summary: Update a todo item
      description: Partial update of an item. Only provided fields are updated.
      tags: [Items]
      parameters:
        - $ref: '#/components/parameters/ListId'
        - $ref: '#/components/parameters/ItemId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateItemRequest'
      responses:
        '200':
          description: Item updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoItem'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /v1/tasks:
    get:
      operationId: listTasks
      summary: Search and filter tasks globally
      description: Retrieve tasks with optional filtering, sorting, and pagination
      tags: [Tasks]
      parameters:
        - name: listId
          in: query
          description: Filter by list ID
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          description: Filter by status
          schema:
            $ref: '#/components/schemas/TaskStatus'
        - name: priority
          in: query
          description: Filter by priority
          schema:
            $ref: '#/components/schemas/TaskPriority'
        - name: tag
          in: query
          description: Filter by tag (exact match)
          schema:
            type: string
        - name: dueBefore
          in: query
          description: Filter tasks due before this time
          schema:
            type: string
            format: date-time
        - name: dueAfter
          in: query
          description: Filter tasks due after this time
          schema:
            type: string
            format: date-time
        - name: orderBy
          in: query
          description: Sort order (e.g., "due_time", "priority", "created_at desc")
          schema:
            type: string
            default: created_at
        - name: pageSize
          in: query
          description: Number of items per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 50
        - name: pageToken
          in: query
          description: Pagination token from previous response
          schema:
            type: string
      responses:
        '200':
          description: Tasks retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListTasksResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalError'

  /v1/lists/{listId}/recurring-templates:
    post:
      operationId: createRecurringTemplate
      summary: Create a recurring task template
      tags: [Recurring]
      parameters:
        - $ref: '#/components/parameters/ListId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRecurringTemplateRequest'
      responses:
        '201':
          description: Template created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecurringTaskTemplate'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    get:
      operationId: listRecurringTemplates
      summary: List recurring templates for a list
      tags: [Recurring]
      parameters:
        - $ref: '#/components/parameters/ListId'
        - name: activeOnly
          in: query
          description: Only return active templates
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Templates retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListRecurringTemplatesResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

  /v1/recurring-templates/{templateId}:
    get:
      operationId: getRecurringTemplate
      summary: Get a recurring template
      tags: [Recurring]
      parameters:
        - $ref: '#/components/parameters/TemplateId'
      responses:
        '200':
          description: Template retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecurringTaskTemplate'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    patch:
      operationId: updateRecurringTemplate
      summary: Update a recurring template
      description: Partial update of a template. Only provided fields are updated.
      tags: [Recurring]
      parameters:
        - $ref: '#/components/parameters/TemplateId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRecurringTemplateRequest'
      responses:
        '200':
          description: Template updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecurringTaskTemplate'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

    delete:
      operationId: deleteRecurringTemplate
      summary: Delete a recurring template
      tags: [Recurring]
      parameters:
        - $ref: '#/components/parameters/TemplateId'
      responses:
        '204':
          description: Template deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalError'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      description: API key in format sk-mono-v1-{shortToken}-{longSecret}

  parameters:
    ListId:
      name: listId
      in: path
      required: true
      description: Todo list ID
      schema:
        type: string
        format: uuid

    ItemId:
      name: itemId
      in: path
      required: true
      description: Todo item ID
      schema:
        type: string
        format: uuid

    TemplateId:
      name: templateId
      in: path
      required: true
      description: Recurring template ID
      schema:
        type: string
        format: uuid

  responses:
    BadRequest:
      description: Invalid request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    Unauthorized:
      description: Authentication required
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    InternalError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

  schemas:
    Error:
      type: object
      required:
        - type
        - title
        - status
      properties:
        type:
          type: string
          format: uri
          description: A URI reference identifying the problem type
          example: /errors/invalid-request
        title:
          type: string
          description: A short human-readable summary
          example: Invalid Request
        status:
          type: integer
          description: HTTP status code
          example: 400
        detail:
          type: string
          description: Human-readable explanation specific to this occurrence
          example: The title field is required
        instance:
          type: string
          format: uri
          description: URI reference identifying the specific occurrence

    TaskStatus:
      type: string
      enum:
        - TODO
        - IN_PROGRESS
        - BLOCKED
        - DONE
        - ARCHIVED
        - CANCELLED
      description: |
        Task status:
        * `TODO` - Ready to start
        * `IN_PROGRESS` - Currently being worked on
        * `BLOCKED` - Blocked by dependencies
        * `DONE` - Completed successfully
        * `ARCHIVED` - Archived for records
        * `CANCELLED` - Cancelled, won't complete

    TaskPriority:
      type: string
      enum:
        - LOW
        - MEDIUM
        - HIGH
        - URGENT
      description: |
        Task priority:
        * `LOW` - Nice to have, low urgency
        * `MEDIUM` - Standard priority
        * `HIGH` - Important, should be done soon
        * `URGENT` - Critical, requires immediate attention

    RecurrencePattern:
      type: string
      enum:
        - DAILY
        - WEEKLY
        - BIWEEKLY
        - MONTHLY
        - YEARLY
        - QUARTERLY
        - WEEKDAYS
      description: |
        How often a recurring task repeats:
        * `DAILY` - Every day
        * `WEEKLY` - Every week
        * `BIWEEKLY` - Every 2 weeks
        * `MONTHLY` - Every month
        * `YEARLY` - Every year
        * `QUARTERLY` - Every 3 months
        * `WEEKDAYS` - Monday through Friday

    TodoItem:
      type: object
      required:
        - id
        - title
        - status
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
          description: Unique item identifier
          readOnly: true
        title:
          type: string
          minLength: 1
          description: Item title
        status:
          $ref: '#/components/schemas/TaskStatus'
        priority:
          $ref: '#/components/schemas/TaskPriority'
        tags:
          type: array
          items:
            type: string
          description: Tags for categorization
        dueTime:
          type: string
          format: date-time
          description: When the task is due
        timezone:
          type: string
          description: IANA timezone for due time (e.g., 'Europe/Stockholm'). Empty means floating time.
          example: America/New_York
        estimatedDuration:
          type: string
          description: Estimated duration in ISO 8601 format (e.g., PT1H30M)
          example: PT1H30M
        actualDuration:
          type: string
          description: Actual duration in ISO 8601 format
          example: PT2H
        recurringTemplateId:
          type: string
          format: uuid
          description: ID of the template this task was generated from (if recurring)
        instanceDate:
          type: string
          format: date-time
          description: Anchor date for this recurring instance
        createdAt:
          type: string
          format: date-time
          description: When the item was created
          readOnly: true
        updatedAt:
          type: string
          format: date-time
          description: When the item was last updated
          readOnly: true

    TodoList:
      type: object
      required:
        - id
        - title
        - createdAt
      properties:
        id:
          type: string
          format: uuid
          description: Unique list identifier
          readOnly: true
        title:
          type: string
          minLength: 1
          description: List title
        items:
          type: array
          items:
            $ref: '#/components/schemas/TodoItem'
          description: Items in this list (populated in getList, empty in listLists)
        totalItems:
          type: integer
          description: Total number of items (populated in listLists)
          readOnly: true
        undoneItems:
          type: integer
          description: Count of TODO, IN_PROGRESS, BLOCKED items (populated in listLists)
          readOnly: true
        createdAt:
          type: string
          format: date-time
          description: When the list was created
          readOnly: true

    RecurringTaskTemplate:
      type: object
      required:
        - id
        - listId
        - title
        - recurrencePattern
        - isActive
        - createdAt
        - updatedAt
      properties:
        id:
          type: string
          format: uuid
          description: Unique template identifier
          readOnly: true
        listId:
          type: string
          format: uuid
          description: ID of the list this template belongs to
        title:
          type: string
          minLength: 1
          description: Template title (used for generated tasks)
        tags:
          type: array
          items:
            type: string
          description: Tags for generated tasks
        priority:
          $ref: '#/components/schemas/TaskPriority'
        estimatedDuration:
          type: string
          description: Estimated duration in ISO 8601 format
          example: PT1H
        recurrencePattern:
          $ref: '#/components/schemas/RecurrencePattern'
        recurrenceConfig:
          type: object
          additionalProperties: true
          description: Pattern-specific configuration (JSON object)
        dueOffset:
          type: string
          description: Relative due time offset from instance date in ISO 8601 format
          example: PT9H
        isActive:
          type: boolean
          description: Whether the template is active
        generationWindowDays:
          type: integer
          minimum: 1
          maximum: 365
          default: 30
          description: How many days ahead to generate tasks
        lastGeneratedUntil:
          type: string
          format: date-time
          description: Last date tasks were generated until
          readOnly: true
        createdAt:
          type: string
          format: date-time
          description: When the template was created
          readOnly: true
        updatedAt:
          type: string
          format: date-time
          description: When the template was last updated
          readOnly: true

    CreateListRequest:
      type: object
      required:
        - title
      properties:
        title:
          type: string
          minLength: 1
          description: List title

    ListListsResponse:
      type: object
      required:
        - lists
      properties:
        lists:
          type: array
          items:
            $ref: '#/components/schemas/TodoList'

    CreateItemRequest:
      type: object
      required:
        - title
      properties:
        title:
          type: string
          minLength: 1
          description: Item title
        priority:
          $ref: '#/components/schemas/TaskPriority'
        tags:
          type: array
          items:
            type: string
        dueTime:
          type: string
          format: date-time
        timezone:
          type: string
          description: IANA timezone (e.g., 'Europe/Stockholm'). Empty means floating time.
        estimatedDuration:
          type: string
          description: ISO 8601 duration (e.g., PT1H30M)
        recurringTemplateId:
          type: string
          format: uuid
          description: Optional template ID if this is a recurring instance
        instanceDate:
          type: string
          format: date-time
          description: Optional anchor date for recurring instance

    UpdateItemRequest:
      type: object
      properties:
        title:
          type: string
          minLength: 1
        status:
          $ref: '#/components/schemas/TaskStatus'
        priority:
          $ref: '#/components/schemas/TaskPriority'
        tags:
          type: array
          items:
            type: string
        dueTime:
          type: string
          format: date-time
          nullable: true
        timezone:
          type: string
          nullable: true
        estimatedDuration:
          type: string
          nullable: true
        actualDuration:
          type: string
          nullable: true

    ListTasksResponse:
      type: object
      required:
        - items
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/TodoItem'
        nextPageToken:
          type: string
          description: Token for fetching next page (empty if no more results)

    CreateRecurringTemplateRequest:
      type: object
      required:
        - title
        - recurrencePattern
      properties:
        title:
          type: string
          minLength: 1
        tags:
          type: array
          items:
            type: string
        priority:
          $ref: '#/components/schemas/TaskPriority'
        estimatedDuration:
          type: string
          description: ISO 8601 duration
        recurrencePattern:
          $ref: '#/components/schemas/RecurrencePattern'
        recurrenceConfig:
          type: object
          additionalProperties: true
        dueOffset:
          type: string
          description: ISO 8601 duration offset for due time
        generationWindowDays:
          type: integer
          minimum: 1
          maximum: 365
          default: 30

    UpdateRecurringTemplateRequest:
      type: object
      properties:
        title:
          type: string
          minLength: 1
        tags:
          type: array
          items:
            type: string
        priority:
          $ref: '#/components/schemas/TaskPriority'
        estimatedDuration:
          type: string
          nullable: true
        recurrencePattern:
          $ref: '#/components/schemas/RecurrencePattern'
        recurrenceConfig:
          type: object
          additionalProperties: true
        dueOffset:
          type: string
          nullable: true
        isActive:
          type: boolean

    ListRecurringTemplatesResponse:
      type: object
      required:
        - templates
      properties:
        templates:
          type: array
          items:
            $ref: '#/components/schemas/RecurringTaskTemplate'
